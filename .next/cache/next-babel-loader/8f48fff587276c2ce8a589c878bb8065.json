{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// react\nimport { useEffect, useRef, useState } from 'react'; // third-party\n\nimport { useIntl } from 'react-intl'; // application\n\nimport { vehicleApi } from '~/api';\n\nfunction makeItems(itemsDef) {\n  return itemsDef.map(function (itemDef, index) {\n    return _objectSpread(_objectSpread({}, itemDef), {}, {\n      value: 'none',\n      loading: false,\n      options: [],\n      disabled: index !== 0\n    });\n  });\n}\n\nfunction getItemValue(item) {\n  var itemValue = item.value;\n\n  if (itemValue !== 'none' && item.deserializeOptionFn) {\n    return item.deserializeOptionFn(itemValue, item);\n  }\n\n  return itemValue;\n}\n\nfunction getItemValues(items) {\n  return items.reduce(function (acc, prevItem) {\n    return [].concat(_toConsumableArray(acc), [getItemValue(prevItem)]);\n  }, []);\n}\n\nfunction serializeOption(option, item) {\n  if (item.serializeOptionFn) {\n    return item.serializeOptionFn(option, item);\n  }\n\n  return option;\n}\n\nfunction deserializeOption(option, item) {\n  if (item.deserializeOptionFn) {\n    return item.deserializeOptionFn(option, item);\n  }\n\n  return option;\n}\n\nexport default function useVehicleForm() {\n  _s();\n\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var intl = useIntl();\n  var onChange = options.onChange;\n  var cancelPrevRequestRef = useRef(function () {});\n\n  var _useState = useState(makeItems([{\n    key: 'year',\n    label: intl.formatMessage({\n      id: 'INPUT_VEHICLE_YEAR_LABEL'\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_VEHICLE_YEAR_PLACEHOLDER'\n    }),\n    optionsSource: vehicleApi.getYears.bind(vehicleApi),\n    serializeOptionFn: function serializeOptionFn(option) {\n      return option.toString();\n    },\n    deserializeOptionFn: function deserializeOptionFn(option) {\n      return parseFloat(option);\n    }\n  }, {\n    key: 'brand',\n    label: intl.formatMessage({\n      id: 'INPUT_VEHICLE_BRAND_LABEL'\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_VEHICLE_BRAND_PLACEHOLDER'\n    }),\n    optionsSource: vehicleApi.getMakes.bind(vehicleApi)\n  }, {\n    key: 'model',\n    label: intl.formatMessage({\n      id: 'INPUT_VEHICLE_MODEL_LABEL'\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_VEHICLE_MODEL_PLACEHOLDER'\n    }),\n    optionsSource: vehicleApi.getModels.bind(vehicleApi)\n  }, {\n    key: 'engine',\n    label: intl.formatMessage({\n      id: 'INPUT_VEHICLE_ENGINE_LABEL'\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_VEHICLE_ENGINE_PLACEHOLDER'\n    }),\n    optionsSource: vehicleApi.getVehicles.bind(vehicleApi),\n    serializeOptionFn: function serializeOptionFn(option) {\n      return option.engine;\n    },\n    deserializeOptionFn: function deserializeOptionFn(option, item) {\n      return item.options.find(function (x) {\n        return x.engine === option;\n      });\n    }\n  }])),\n      items = _useState[0],\n      setItems = _useState[1];\n\n  var load = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(items, index) {\n      var canceled, item, args, optionsSource, options;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              cancelPrevRequestRef.current();\n              canceled = false;\n\n              cancelPrevRequestRef.current = function () {\n                canceled = true;\n              };\n\n              setItems(function (prevItems) {\n                return _toConsumableArray(prevItems.map(function (prevItem, prevItemIdx) {\n                  return prevItemIdx !== index ? prevItem : _objectSpread(_objectSpread({}, prevItem), {}, {\n                    loading: true\n                  });\n                }));\n              });\n              item = items[index];\n              args = getItemValues(items.slice(0, index));\n              optionsSource = Promise.resolve([]);\n\n              if (args.length === 0 || args.slice().pop() !== 'none') {\n                optionsSource = item.optionsSource.apply(item, _toConsumableArray(args));\n              }\n\n              _context.next = 10;\n              return optionsSource;\n\n            case 10:\n              options = _context.sent;\n\n              if (!canceled) {\n                _context.next = 13;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 13:\n              setItems(function (prevItems) {\n                return _toConsumableArray(prevItems.map(function (prevItem, prevItemIdx) {\n                  return prevItemIdx !== index ? prevItem : _objectSpread(_objectSpread({}, prevItem), {}, {\n                    options: options,\n                    loading: false\n                  });\n                }));\n              });\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function load(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var onItemValueChange = function onItemValueChange(index, value) {\n    var nextItemIdx = index + 1;\n    setItems(function (prevItems) {\n      var resultItems = prevItems;\n      resultItems = _toConsumableArray(resultItems.map(function (prevItem, prevItemIdx) {\n        return prevItemIdx !== index ? prevItem : _objectSpread(_objectSpread({}, prevItem), {}, {\n          value: value\n        });\n      }));\n      resultItems = _toConsumableArray(resultItems.map(function (prevItem, prevItemIdx) {\n        return prevItemIdx <= index ? prevItem : _objectSpread(_objectSpread({}, prevItem), {}, {\n          value: 'none',\n          options: [],\n          disabled: true\n        });\n      }));\n\n      if (value !== 'none' && resultItems[nextItemIdx]) {\n        resultItems = _toConsumableArray(resultItems.map(function (prevItem, prevItemIdx) {\n          return prevItemIdx !== nextItemIdx ? prevItem : _objectSpread(_objectSpread({}, prevItem), {}, {\n            disabled: false\n          });\n        }));\n      }\n\n      return resultItems;\n    });\n\n    if (value === 'none') {\n      if (onChange) {\n        onChange(null);\n      }\n    } else if (!items[nextItemIdx] && onChange) {\n      onChange(deserializeOption(value, items[index]));\n    }\n  }; // Load items.\n\n\n  useEffect(function () {\n    var prevValue = null;\n\n    for (var i = 0; i < items.length; i += 1) {\n      var _item = items[i];\n\n      if (prevValue !== 'none' && _item.options.length === 0 && !_item.loading) {\n        load(items, i).then();\n        return;\n      }\n\n      prevValue = _item.value;\n    }\n  }, [items]);\n  return {\n    items: items,\n    onItemValueChange: onItemValueChange,\n    serializeOption: serializeOption\n  };\n}\n\n_s(useVehicleForm, \"Wl1/F/e+GQ1DME81mMGoiABY5hM=\", false, function () {\n  return [useIntl];\n});","map":{"version":3,"sources":["C:/Users/Shbaita Studio/Documents/project/new1/themeforest-irsnufCS-redparts-auto-parts-react-ecommerce-template/Sources/src/services/forms/vehicle.ts"],"names":["useEffect","useRef","useState","useIntl","vehicleApi","makeItems","itemsDef","map","itemDef","index","value","loading","options","disabled","getItemValue","item","itemValue","deserializeOptionFn","getItemValues","items","reduce","acc","prevItem","serializeOption","option","serializeOptionFn","deserializeOption","useVehicleForm","intl","onChange","cancelPrevRequestRef","key","label","formatMessage","id","placeholder","optionsSource","getYears","bind","toString","parseFloat","getMakes","getModels","getVehicles","engine","find","x","setItems","load","current","canceled","prevItems","prevItemIdx","args","slice","Promise","resolve","length","pop","onItemValueChange","nextItemIdx","resultItems","prevValue","i","then"],"mappings":"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","sourcesContent":["// react\nimport { useEffect, useRef, useState } from 'react';\n// third-party\nimport { useIntl } from 'react-intl';\n// application\nimport { IVehicle } from '~/interfaces/vehicle';\nimport { vehicleApi } from '~/api';\n\ninterface VehicleSelectItemDef<T = any> {\n    key: string;\n    label: string;\n    placeholder: string;\n    optionsSource: (...args: any[]) => Promise<T[]>;\n    serializeOptionFn?: (option: T, item: VehicleSelectItem<T>) => string;\n    deserializeOptionFn?: (value: string, item: VehicleSelectItem<T>) => T;\n}\n\ninterface VehicleSelectItem<T = any> extends VehicleSelectItemDef<T> {\n    value: string;\n    loading: boolean;\n    options: T[];\n    disabled: boolean,\n}\n\nfunction makeItems(itemsDef: VehicleSelectItemDef[]): VehicleSelectItem[] {\n    return itemsDef.map((itemDef, index) => ({\n        ...itemDef,\n        value: 'none',\n        loading: false,\n        options: [],\n        disabled: index !== 0,\n    }));\n}\n\nfunction getItemValue(item: VehicleSelectItem): any {\n    const { value: itemValue } = item;\n\n    if (itemValue !== 'none' && item.deserializeOptionFn) {\n        return item.deserializeOptionFn(itemValue, item);\n    }\n\n    return itemValue;\n}\n\nfunction getItemValues(items: VehicleSelectItem[]): any[] {\n    return items.reduce<any[]>((acc, prevItem) => [...acc, getItemValue(prevItem)], []);\n}\n\nfunction serializeOption(option: any, item: VehicleSelectItem): string {\n    if (item.serializeOptionFn) {\n        return item.serializeOptionFn(option, item);\n    }\n\n    return option;\n}\n\nfunction deserializeOption<T extends any>(option: string, item: VehicleSelectItem<T>): T {\n    if (item.deserializeOptionFn) {\n        return item.deserializeOptionFn(option, item);\n    }\n\n    return option as any;\n}\n\ninterface IOptions {\n    onChange?: (vehicle: IVehicle | null) => void;\n}\n\nexport default function useVehicleForm(options: IOptions = {}) {\n    const intl = useIntl();\n    const { onChange } = options;\n    const cancelPrevRequestRef = useRef(() => {});\n    const [items, setItems] = useState(makeItems([\n        {\n            key: 'year',\n            label: intl.formatMessage({ id: 'INPUT_VEHICLE_YEAR_LABEL' }),\n            placeholder: intl.formatMessage({ id: 'INPUT_VEHICLE_YEAR_PLACEHOLDER' }),\n            optionsSource: vehicleApi.getYears.bind(vehicleApi),\n            serializeOptionFn: (option: number) => option.toString(),\n            deserializeOptionFn: (option: string) => parseFloat(option),\n        },\n        {\n            key: 'brand',\n            label: intl.formatMessage({ id: 'INPUT_VEHICLE_BRAND_LABEL' }),\n            placeholder: intl.formatMessage({ id: 'INPUT_VEHICLE_BRAND_PLACEHOLDER' }),\n            optionsSource: vehicleApi.getMakes.bind(vehicleApi),\n        },\n        {\n            key: 'model',\n            label: intl.formatMessage({ id: 'INPUT_VEHICLE_MODEL_LABEL' }),\n            placeholder: intl.formatMessage({ id: 'INPUT_VEHICLE_MODEL_PLACEHOLDER' }),\n            optionsSource: vehicleApi.getModels.bind(vehicleApi),\n        },\n        {\n            key: 'engine',\n            label: intl.formatMessage({ id: 'INPUT_VEHICLE_ENGINE_LABEL' }),\n            placeholder: intl.formatMessage({ id: 'INPUT_VEHICLE_ENGINE_PLACEHOLDER' }),\n            optionsSource: vehicleApi.getVehicles.bind(vehicleApi),\n            serializeOptionFn: (option: IVehicle) => option.engine,\n            deserializeOptionFn: (option: string, item: VehicleSelectItem<IVehicle>) => (\n                item.options.find((x) => x.engine === option)!\n            ),\n        },\n    ]));\n\n    const load = async (items: VehicleSelectItem[], index: number) => {\n        cancelPrevRequestRef.current();\n\n        let canceled = false;\n        cancelPrevRequestRef.current = () => {\n            canceled = true;\n        };\n\n        setItems((prevItems) => [\n            ...prevItems.map((prevItem, prevItemIdx) => (\n                prevItemIdx !== index ? prevItem : {\n                    ...prevItem,\n                    loading: true,\n                }\n            )),\n        ]);\n\n        const item = items[index];\n        const args = getItemValues(items.slice(0, index));\n\n        let optionsSource = Promise.resolve<any[]>([]);\n\n        if (args.length === 0 || args.slice().pop() !== 'none') {\n            optionsSource = item.optionsSource(...args);\n        }\n\n        const options = await optionsSource;\n\n        if (canceled) {\n            return;\n        }\n\n        setItems((prevItems) => [\n            ...prevItems.map((prevItem, prevItemIdx) => (\n                prevItemIdx !== index ? prevItem : {\n                    ...prevItem,\n                    options,\n                    loading: false,\n                }\n            )),\n        ]);\n    };\n\n    const onItemValueChange = (index: number, value: string): void => {\n        const nextItemIdx = index + 1;\n\n        setItems((prevItems) => {\n            let resultItems = prevItems;\n\n            resultItems = [\n                ...resultItems.map(\n                    (prevItem, prevItemIdx) => (prevItemIdx !== index ? prevItem : {\n                        ...prevItem,\n                        value,\n                    }),\n                ),\n            ];\n\n            resultItems = [\n                ...resultItems.map(\n                    (prevItem, prevItemIdx) => (prevItemIdx <= index ? prevItem : {\n                        ...prevItem,\n                        value: 'none',\n                        options: [],\n                        disabled: true,\n                    }),\n                ),\n            ];\n\n            if (value !== 'none' && resultItems[nextItemIdx]) {\n                resultItems = [\n                    ...resultItems.map(\n                        (prevItem, prevItemIdx) => (prevItemIdx !== nextItemIdx ? prevItem : {\n                            ...prevItem,\n                            disabled: false,\n                        }),\n                    ),\n                ];\n            }\n\n            return resultItems;\n        });\n\n        if (value === 'none') {\n            if (onChange) {\n                onChange(null);\n            }\n        } else if (!items[nextItemIdx] && onChange) {\n            onChange(deserializeOption<IVehicle>(value, items[index] as VehicleSelectItem<IVehicle>));\n        }\n    };\n\n    // Load items.\n    useEffect(() => {\n        let prevValue = null;\n\n        for (let i = 0; i < items.length; i += 1) {\n            const item = items[i];\n\n            if (prevValue !== 'none' && item.options.length === 0 && !item.loading) {\n                load(items, i).then();\n\n                return;\n            }\n\n            prevValue = item.value;\n        }\n    }, [items]);\n\n    return {\n        items,\n        onItemValueChange,\n        serializeOption,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}