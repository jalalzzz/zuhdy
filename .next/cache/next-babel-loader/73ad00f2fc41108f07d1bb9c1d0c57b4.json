{"ast":null,"code":"// third-party\nimport queryString from 'query-string'; // application\n\nimport { shopInitThunk } from '~/store/shop/shopActions';\nexport function parseQueryOptions(query) {\n  const queryObject = queryString.parse(query);\n  const optionValues = {};\n\n  if (typeof queryObject.page === 'string') {\n    optionValues.page = parseFloat(queryObject.page);\n  }\n\n  if (typeof queryObject.limit === 'string') {\n    optionValues.limit = parseFloat(queryObject.limit);\n  }\n\n  if (typeof queryObject.sort === 'string') {\n    optionValues.sort = queryObject.sort;\n  }\n\n  return optionValues;\n}\nexport function parseQueryFilters(query) {\n  const queryObject = queryString.parse(query);\n  const filterValues = {};\n  Object.keys(queryObject).forEach(param => {\n    const value = queryObject[param];\n    const mr = param.match(/^filter_([-_A-Za-z0-9]+)$/);\n\n    if (!mr || typeof value !== 'string') {\n      return;\n    }\n\n    const filterSlug = mr[1];\n    filterValues[filterSlug] = value;\n  });\n  return filterValues;\n}\nexport function buildQuery(options, filters) {\n  const params = {};\n\n  if (options.page !== 1) {\n    params.page = options.page;\n  }\n\n  if (options.limit !== 12) {\n    params.limit = options.limit;\n  }\n\n  if (options.sort !== 'default') {\n    params.sort = options.sort;\n  }\n\n  Object.keys(filters).filter(x => x !== 'category' && !!filters[x]).forEach(filterSlug => {\n    params[`filter_${filterSlug}`] = filters[filterSlug];\n  });\n  return queryString.stringify(params, {\n    encode: false\n  });\n}\nexport default async function getShopPageData(context, slug) {\n  var _context$params;\n\n  const categorySlug = slug || (typeof ((_context$params = context.params) === null || _context$params === void 0 ? void 0 : _context$params.slug) === 'string' ? context.params.slug : null);\n\n  if (typeof context.req.url === 'string') {\n    const query = queryString.stringify(queryString.parseUrl(context.req.url).query);\n    const options = parseQueryOptions(query);\n    const filters = parseQueryFilters(query);\n    const dispatch = context.store.dispatch;\n    await dispatch(shopInitThunk(categorySlug, options, filters));\n  }\n}","map":{"version":3,"sources":["C:/Users/Shbaita Studio/Documents/project/new1/themeforest-irsnufCS-redparts-auto-parts-react-ecommerce-template/Sources/src/store/shop/shopHelpers.ts"],"names":["queryString","shopInitThunk","parseQueryOptions","query","queryObject","parse","optionValues","page","parseFloat","limit","sort","parseQueryFilters","filterValues","Object","keys","forEach","param","value","mr","match","filterSlug","buildQuery","options","filters","params","filter","x","stringify","encode","getShopPageData","context","slug","categorySlug","req","url","parseUrl","dispatch","store"],"mappings":"AAAA;AACA,OAAOA,WAAP,MAAwB,cAAxB,C,CACA;;AAIA,SAASC,aAAT,QAA8B,0BAA9B;AAEA,OAAO,SAASC,iBAAT,CAA2BC,KAA3B,EAA0C;AAC7C,QAAMC,WAAW,GAAGJ,WAAW,CAACK,KAAZ,CAAkBF,KAAlB,CAApB;AACA,QAAMG,YAA0B,GAAG,EAAnC;;AAEA,MAAI,OAAOF,WAAW,CAACG,IAAnB,KAA4B,QAAhC,EAA0C;AACtCD,IAAAA,YAAY,CAACC,IAAb,GAAoBC,UAAU,CAACJ,WAAW,CAACG,IAAb,CAA9B;AACH;;AACD,MAAI,OAAOH,WAAW,CAACK,KAAnB,KAA6B,QAAjC,EAA2C;AACvCH,IAAAA,YAAY,CAACG,KAAb,GAAqBD,UAAU,CAACJ,WAAW,CAACK,KAAb,CAA/B;AACH;;AACD,MAAI,OAAOL,WAAW,CAACM,IAAnB,KAA4B,QAAhC,EAA0C;AACtCJ,IAAAA,YAAY,CAACI,IAAb,GAAoBN,WAAW,CAACM,IAAhC;AACH;;AAED,SAAOJ,YAAP;AACH;AAED,OAAO,SAASK,iBAAT,CAA2BR,KAA3B,EAA0C;AAC7C,QAAMC,WAAW,GAAGJ,WAAW,CAACK,KAAZ,CAAkBF,KAAlB,CAApB;AACA,QAAMS,YAA2B,GAAG,EAApC;AAEAC,EAAAA,MAAM,CAACC,IAAP,CAAYV,WAAZ,EAAyBW,OAAzB,CAAkCC,KAAD,IAAW;AACxC,UAAMC,KAAK,GAAGb,WAAW,CAACY,KAAD,CAAzB;AACA,UAAME,EAAE,GAAGF,KAAK,CAACG,KAAN,CAAY,2BAAZ,CAAX;;AAEA,QAAI,CAACD,EAAD,IAAO,OAAOD,KAAP,KAAiB,QAA5B,EAAsC;AAClC;AACH;;AAED,UAAMG,UAAU,GAAGF,EAAE,CAAC,CAAD,CAArB;AAEAN,IAAAA,YAAY,CAACQ,UAAD,CAAZ,GAA2BH,KAA3B;AACH,GAXD;AAaA,SAAOL,YAAP;AACH;AAED,OAAO,SAASS,UAAT,CAAoBC,OAApB,EAA2CC,OAA3C,EAAmE;AACtE,QAAMC,MAA8B,GAAG,EAAvC;;AAEA,MAAIF,OAAO,CAACf,IAAR,KAAiB,CAArB,EAAwB;AACpBiB,IAAAA,MAAM,CAACjB,IAAP,GAAce,OAAO,CAACf,IAAtB;AACH;;AAED,MAAIe,OAAO,CAACb,KAAR,KAAkB,EAAtB,EAA0B;AACtBe,IAAAA,MAAM,CAACf,KAAP,GAAea,OAAO,CAACb,KAAvB;AACH;;AAED,MAAIa,OAAO,CAACZ,IAAR,KAAiB,SAArB,EAAgC;AAC5Bc,IAAAA,MAAM,CAACd,IAAP,GAAcY,OAAO,CAACZ,IAAtB;AACH;;AAEDG,EAAAA,MAAM,CAACC,IAAP,CAAYS,OAAZ,EAAqBE,MAArB,CAA6BC,CAAD,IAAOA,CAAC,KAAK,UAAN,IAAoB,CAAC,CAACH,OAAO,CAACG,CAAD,CAAhE,EAAqEX,OAArE,CAA8EK,UAAD,IAAgB;AACzFI,IAAAA,MAAM,CAAE,UAASJ,UAAW,EAAtB,CAAN,GAAiCG,OAAO,CAACH,UAAD,CAAxC;AACH,GAFD;AAIA,SAAOpB,WAAW,CAAC2B,SAAZ,CAAsBH,MAAtB,EAA8B;AAAEI,IAAAA,MAAM,EAAE;AAAV,GAA9B,CAAP;AACH;AAED,eAAe,eAAeC,eAAf,CAA+BC,OAA/B,EAAmEC,IAAnE,EAAiG;AAAA;;AAC5G,QAAMC,YAAY,GAAGD,IAAI,KAAK,2BAAOD,OAAO,CAACN,MAAf,oDAAO,gBAAgBO,IAAvB,MAAgC,QAAhC,GAA2CD,OAAO,CAACN,MAAR,CAAeO,IAA1D,GAAiE,IAAtE,CAAzB;;AAEA,MAAI,OAAOD,OAAO,CAACG,GAAR,CAAYC,GAAnB,KAA2B,QAA/B,EAAyC;AACrC,UAAM/B,KAAK,GAAGH,WAAW,CAAC2B,SAAZ,CAAsB3B,WAAW,CAACmC,QAAZ,CAAqBL,OAAO,CAACG,GAAR,CAAYC,GAAjC,EAAsC/B,KAA5D,CAAd;AACA,UAAMmB,OAAO,GAAGpB,iBAAiB,CAACC,KAAD,CAAjC;AACA,UAAMoB,OAAO,GAAGZ,iBAAiB,CAACR,KAAD,CAAjC;AACA,UAAMiC,QAAQ,GAAGN,OAAO,CAACO,KAAR,CAAcD,QAA/B;AAEA,UAAMA,QAAQ,CAACnC,aAAa,CAAC+B,YAAD,EAAeV,OAAf,EAAwBC,OAAxB,CAAd,CAAd;AACH;AACJ","sourcesContent":["// third-party\nimport queryString from 'query-string';\n// application\nimport { AppDispatch } from '~/store/types';\nimport { GetServerSidePropsContext } from '~/store/store';\nimport { IFilterValues, IListOptions } from '~/interfaces/list';\nimport { shopInitThunk } from '~/store/shop/shopActions';\n\nexport function parseQueryOptions(query: string) {\n    const queryObject = queryString.parse(query);\n    const optionValues: IListOptions = {};\n\n    if (typeof queryObject.page === 'string') {\n        optionValues.page = parseFloat(queryObject.page);\n    }\n    if (typeof queryObject.limit === 'string') {\n        optionValues.limit = parseFloat(queryObject.limit);\n    }\n    if (typeof queryObject.sort === 'string') {\n        optionValues.sort = queryObject.sort;\n    }\n\n    return optionValues;\n}\n\nexport function parseQueryFilters(query: string) {\n    const queryObject = queryString.parse(query);\n    const filterValues: IFilterValues = {};\n\n    Object.keys(queryObject).forEach((param) => {\n        const value = queryObject[param];\n        const mr = param.match(/^filter_([-_A-Za-z0-9]+)$/);\n\n        if (!mr || typeof value !== 'string') {\n            return;\n        }\n\n        const filterSlug = mr[1];\n\n        filterValues[filterSlug] = value;\n    });\n\n    return filterValues;\n}\n\nexport function buildQuery(options: IListOptions, filters: IFilterValues) {\n    const params: { [key: string]: any } = {};\n\n    if (options.page !== 1) {\n        params.page = options.page;\n    }\n\n    if (options.limit !== 12) {\n        params.limit = options.limit;\n    }\n\n    if (options.sort !== 'default') {\n        params.sort = options.sort;\n    }\n\n    Object.keys(filters).filter((x) => x !== 'category' && !!filters[x]).forEach((filterSlug) => {\n        params[`filter_${filterSlug}`] = filters[filterSlug];\n    });\n\n    return queryString.stringify(params, { encode: false });\n}\n\nexport default async function getShopPageData(context: GetServerSidePropsContext, slug?: string): Promise<void> {\n    const categorySlug = slug || (typeof context.params?.slug === 'string' ? context.params.slug : null);\n\n    if (typeof context.req.url === 'string') {\n        const query = queryString.stringify(queryString.parseUrl(context.req.url).query);\n        const options = parseQueryOptions(query);\n        const filters = parseQueryFilters(query);\n        const dispatch = context.store.dispatch as AppDispatch;\n\n        await dispatch(shopInitThunk(categorySlug, options, filters));\n    }\n}\n"]},"metadata":{},"sourceType":"module"}